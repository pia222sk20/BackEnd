## 1부 AWS S3 버킷 생성 및 권한 설정 (콘솔 작업)

서버가 S3에 접근하려면 **저장소(Bucket)**와 **열쇠(IAM Key)**가 필요합니다.

### 1단계: S3 버킷 만들기
1. AWS 콘솔에 로그인하고 **S3** 서비스를 검색하여 들어갑니다.
2. 왼쪽 메뉴나 중앙 탭에서 **[범용 버킷]**이 선택되어 있는지 확인합니다. (기본값)
3. **[버킷 만들기]** 주황색 버튼을 클릭합니다.
4. **일반 구성**:
   - **버킷 유형**: **범용 (General purpose)** 선택 확인.
   - **버킷 이름**: 전 세계에서 유일해야 합니다 (예: `my-fastapi-project-assets-2026`).
   - **AWS 리전**: EC2와 같은 리전(예: `아시아 태평양(서울) ap-northeast-2`)을 선택하는 것이 속도와 비용면에서 좋습니다.
4. **객체 소유권**: `ACL 비활성화됨(권장)` 그대로 둡니다. (화면에 "이 버킷의 모든 객체는 이 계정이 소유합니다"라고 표시됨)
5. **이 버킷의 퍼블릭 액세스 차단 설정**:
   - **중요**: 이미지를 웹에서 누구나 볼 수 있게 하려면(예: 프로필 사진), **[모든 퍼블릭 액세스 차단]** 체크박스를 **해제**해야 합니다.
   - 체크를 해제하면 아래 4개의 하위 옵션(새 ACL 차단, 임의의 ACL 차단 등)이 모두 자동으로 해제됩니다.
   - 하단에 나타나는 경고 체크박스 **"현재 설정이 퍼블릭... 알고 있습니다"** 에 체크합니다.
   - *보안이 중요한 문서라면 차단을 유지해야 하지만, 웹 서비스용 이미지는 보통 풉니다.*
6. **버킷 버전 관리**: `비활성화` (기본값) 그대로 둡니다.
7. **기본 암호화**: `Amazon S3 관리형 키(SSE-S3)를 사용한 서버 측 암호화` (기본값) 그대로 둡니다.
8. 맨 아래 **[버킷 만들기]**를 클릭합니다.

### 2단계: 버킷 정책(Bucket Policy) 설정 (생성 완료 후 진행)
*방금 만든 버킷에 누구나 읽기(다운로드) 권한을 부여하는 단계입니다.*

1. **버킷 만들기**를 완료하면 나오는 리스트에서, 방금 생성된 **버킷 이름**을 클릭합니다.
2. 상단 메뉴 탭 중에서 **[권한]** (Permissions) 탭을 클릭합니다.
3. 화면을 아래로 조금 내려오면 **버킷 정책** (Bucket policy) 섹션이 보입니다.
4. 해당 섹션 우측 상단의 **[편집]** (Edit) 버튼을 클릭합니다.
5. 아래 JSON을 복사해 붙여넣기 합니다 (기존의 빈 내용은 지우세요).
   - `내-버킷-이름` 부분을 실제 여러분의 버킷 이름으로 수정해야 합니다.

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "PublicRead",
            "Effect": "Allow",
            "Principal": "*",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::내-버킷-이름/*"
        }
    ]
}
```
5. **[변경 사항 저장]** 클릭.

### 3단계: IAM 액세스 키 발급 (기존 student 계정 활용)
*현재 AWS 환경(교육용/대행업체)에는 이미 `student`라는 강력한 권한의 사용자가 있습니다. 새로 만들 필요 없이 이 사용자의 키를 발급받으면 됩니다.*

1. **IAM 콘솔**의 왼쪽 메뉴에서 **[사용자]**를 클릭합니다.
2. 목록에 있는 **`student`** 사용자 이름을 클릭하여 들어갑니다.
3. 화면 중간의 **[보안 자격 증명]** (Security credentials) 탭을 클릭합니다.
4. 아래로 조금 내려가서 **액세스 키** (Access keys) 섹션을 찾습니다.
5. 우측의 **[액세스 키 만들기]** (Create access key) 버튼을 클릭합니다.
6. **[로컬 코드]** 또는 **[기타]**를 선택하고 체크박스 동의 후 [다음] -> [액세스 키 만들기]를 완료합니다.
7. **매우 중요**: 화면에 표시된 `Access Key`와 `Secret Access Key`를 복사해서 **메모장에 따로 저장**해둡니다. (이 창을 닫으면 비밀 키는 영영 다시 볼 수 없습니다!)

> **참고**: 만약 `student` 계정으로 키 생성이 안 되거나 권한이 부족하다면, 그때는 '사용자 생성' 버튼을 눌러서 새 사용자를 만들어보세요 (이전 가이드 내용 참고). 하지만 보통 `student` 계정이면 충분합니다.

---

## 2부: FastAPI 프로젝트 설정 (코드 작업)

EC2 또는 로컬 개발 환경에서 진행합니다.

### 1단계: 필수 라이브러리 설치
터미널에서 아래 명령어를 실행합니다.

```bash
pip install boto3 python-multipart pymysql sqlalchemy uvicorn fastapi python-dotenv
```
- `boto3`: AWS S3 통신용 라이브러리
- `python-multipart`: 파일 업로드 처리
- `pymysql`, `sqlalchemy`: RDS(MySQL) 연결

### 2단계: 환경 변수 파일 (.env) 작성
프로젝트 폴더(root)에 `.env` 파일을 만들고 아래 내용을 채워 넣습니다.
(RDS 정보와 방금 받은 S3 정보를 모두 입력합니다)

```env
# 데이터베이스 (RDS) 설정
RDS_HOST=엔드포인트주소(rds.amazonaws.com)
RDS_USER=admin
RDS_PASSWORD=비밀번호
RDS_DB_NAME=데이터베이스이름(예: demo_db)

# AWS S3 설정
AWS_ACCESS_KEY_ID=복사해둔_액세스_키
AWS_SECRET_ACCESS_KEY=복사해둔_시크릿_키
AWS_REGION=ap-northeast-2
S3_BUCKET_NAME=1단계에서_만든_버킷이름
```

---