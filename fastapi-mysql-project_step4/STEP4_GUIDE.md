# π€ Step 4: CRUD API λ° νμΌ μ—…λ΅λ“ κµ¬ν„

μ΄ λ‹¨κ³„μ—μ„λ” μ‹¤μ  λ°μ΄ν„°λ¥Ό μ΅°μ‘ν•λ” APIμ™€ λ΅μ»¬ μ €μ¥μ†λ¥Ό ν™μ©ν• νμΌ μ„λ²„ κΈ°λ¥μ„ κµ¬ν„ν–μµλ‹λ‹¤.

## 1. μ£Όμ” κµ¬ν„ λ‚΄μ©

### A. μ„λΉ„μ¤ λ μ΄μ–΄ (Service Layer)
*   **`ItemService`**: SQLAlchemy λΉ„λ™κΈ° μ„Έμ…μ„ μ‚¬μ©ν•μ—¬ CRUD λ΅μ§μ„ μΊ΅μν™”ν–μµλ‹λ‹¤.
*   **`FileService`**: 
    *   νμΌμ„ `uploads/` ν΄λ”μ— λ¬Όλ¦¬μ μΌλ΅ μ €μ¥ν•©λ‹λ‹¤.
    *   νμΌλ… μ¤‘λ³µ λ°©μ§€λ¥Ό μ„ν•΄ `uuid`λ¥Ό μ‚¬μ©ν•μ—¬ μ΄λ¦„μ„ λ³€κ²½ν•©λ‹λ‹¤.
    *   μ €μ¥λ μ •λ³΄λ¥Ό DB(`uploaded_files` ν…μ΄λΈ”)μ— κΈ°λ΅ν•©λ‹λ‹¤.

### B. API λΌμ°ν… (Routing)
*   `app/api/v1/endpoints/`μ— κΈ°λ¥λ³„λ΅ APIλ¥Ό λ¶„λ¦¬ν–μµλ‹λ‹¤.
*   `v1/api.py`μ—μ„ λ¨λ“  λΌμ°ν„°λ¥Ό ν†µν•©ν•μ—¬ κ΄€λ¦¬ν•©λ‹λ‹¤.
*   `main.py`μ—μ„λ” `/api/v1` μ ‘λ‘μ‚¬(Prefix)λ¥Ό λ¶™μ—¬ μΌκ΄„ λ“±λ΅ν–μµλ‹λ‹¤.

---

## 2. API ν…μ¤νΈ λ°©λ²• (Swagger UI ν™μ©)

1.  **μ„λ²„ μ‹¤ν–‰:**
    ```bash
    cd fastapi-mysql-project_step4
    docker-compose up -d --build
    ```

2.  **Swagger UI μ ‘μ†:** [http://localhost/docs](http://localhost/docs)

3.  **CRUD ν…μ¤νΈ (Items):**
    *   `POST /api/v1/items/`: JSON λ°μ΄ν„°λ¥Ό λ³΄λ‚΄ μ•„μ΄ν…μ„ μƒμ„±ν•©λ‹λ‹¤.
    *   `GET /api/v1/items/`: μƒμ„±λ μ•„μ΄ν… λ©λ΅μ„ ν™•μΈν•©λ‹λ‹¤.

4.  **νμΌ μ—…λ΅λ“ ν…μ¤νΈ (Files):**
    *   `POST /api/v1/files/upload`: μ΄λ―Έμ§€λ‚ λ™μμƒ νμΌμ„ μ„ νƒν•΄μ„ μ—…λ΅λ“ν•©λ‹λ‹¤.
    *   **κ²°κ³Ό ν™•μΈ:** μ‘λ‹µμΌλ΅ μ¨ URLλ΅ μ ‘μ†ν•λ©΄ νμΌμ„ λ³Ό μ μμµλ‹λ‹¤.
    *   **λ©λ΅ μ΅°ν:** `GET /api/v1/files/`λ΅ μ—…λ΅λ“λ λ¨λ“  νμΌ λ©λ΅μ„ ν™•μΈν•  μ μμµλ‹λ‹¤.
    *   **μƒμ„Έ μ΅°ν:** `GET /api/v1/files/{file_id}`λ΅ νΉμ • νμΌμ μ •λ³΄λ¥Ό λ΄…λ‹λ‹¤.
    *   **νμΌ μ‚­μ :** `DELETE /api/v1/files/{file_id}`λ΅ μ—…λ΅λ“λ νμΌμ„ μ‚­μ ν•  μ μμµλ‹λ‹¤. (DB λ°μ΄ν„° + μ‹¤μ  νμΌ λ™μ‹ μ‚­μ )

---

## 3. ν•µμ‹¬ μ•„ν‚¤ν…μ² μ΄ν•΄

*   **FastAPI**: νμΌ μ—…λ΅λ“λ¥Ό λ°›μ•„ λ΅μ»¬ μ €μ¥μ†μ— μ €μ¥ν•κ³  DBμ— μ •λ³΄λ¥Ό μ”λ‹λ‹¤.
*   **Local Storage (Volume)**: Docker Volume λ•λ¶„μ— μ»¨ν…μ΄λ„λ¥Ό μ¬μ‹μ‘ν•΄λ„ `uploads/` ν΄λ”μ νμΌμ€ μ μ§€λ©λ‹λ‹¤.
*   **Nginx**: ν΄λΌμ΄μ–ΈνΈκ°€ νμΌμ„ μ”μ²­ν•λ©΄ FastAPIλ¥Ό κ±°μΉμ§€ μ•κ³  μ§μ ‘ `uploads/` ν΄λ”μ νμΌμ„ λ°ν™ν•©λ‹λ‹¤. (λ§¤μ° λΉ λ¦„)

---

## 4. νΈλ¬λΈ”μν… (Troubleshooting)
κ°λ° μ¤‘ λ°μƒν•  μ μλ” μ£Όμ” μ¤λ¥(ModuleNotFoundError, Pydantic μ—λ¬ λ“±)μ™€ ν•΄κ²°μ±…μ€ λ³„λ„ λ¬Έμ„μ— μ •λ¦¬ν•΄ λ‘μ—μµλ‹λ‹¤.
π‘‰ **[TROUBLESHOOTING.md](./TROUBLESHOOTING.md) μ°Έκ³ **

---

## 5. μ»¨ν…μ΄λ„ λ‚΄λ¶€ μ ‘μ† λ°©λ²• (Debugging)

κ° μ»¨ν…μ΄λ„ λ‚΄λ¶€μ ν™κ²½μ΄λ‚ νμΌμ„ μ§μ ‘ ν™•μΈν•κ³  μ‹¶μ„ λ• μ‚¬μ©ν•©λ‹λ‹¤.

### A. FastAPI μ»¨ν…μ΄λ„ (App)
```bash
docker exec -it fastapi_app bash
```

### B. MySQL μ»¨ν…μ΄λ„ (DB)
```bash
docker exec -it fastapi_db mysql -u myuser -p
# λΉ„λ°€λ²νΈ: mypassword
```

### C. Nginx μ»¨ν…μ΄λ„ (Web)
```bash
docker exec -it fastapi_nginx bash
```

---